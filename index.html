<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>T√†i X·ªâu Casino</title>

<style>
body{
  margin:30;
  background:#0b1020;
  color:#fff;
  font-family:Arial, sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  background:url("images/bg.webp");
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
}

.game{
  width:420px;
  background:#020617;
  border-radius: 30px;
  padding:5px;
}

/* TEXT */
.top{text-align:center;font-weight:bold;}
.money,.bet{text-align:center;margin:6px 0;}
.money-area{
  text-align:center;
  margin:8px 0;
}


/* BET */
.bet{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:6px;
}
.bet span{min-width:40px;text-align:center;}
.bet button{
  width:26px;height:26px;
  border:none;border-radius:50%;
  background:#334155;color:#fff;
  cursor:pointer;
}
.bet button:last-child{background:#dc2626;}

/* CHIP */
.chips{
  display:flex;
  justify-content:center;
  gap:10px;
  margin:10px 0;
}
.chip{
  width:55px;
  cursor:pointer;
  transition:.15s;
}
.chip:hover{transform:scale(1.1);}

/* BOWL */
.bowl-area{
  position:relative;
  width:260px;
  height:20px;
  margin:20px auto 10px; /* üëà tr√™n √≠t, d∆∞·ªõi √≠t */
  margin-top: 250px;
}

.dice-area{
  position:absolute;
  bottom:35px;
  width:100%;
  display:flex;
  justify-content:center;
  gap:15px;
}

.dice{
  width:45px;height:45px;
  background:#fff;color:#000;
  border-radius:8px;
  font-size:24px;font-weight:bold;
  display:flex;
  align-items:center;
  justify-content:center;
}

.bowl-wrap{
  position:absolute;
  bottom:10px;
  width:100%;
  height:140px;
  transition:.25s ease-out;
}

.bowl{
  width:100%;
  height:100%;
  background:#e5e7eb;
  border-radius:140px 140px 0 0;
  cursor:pointer;
}

.plate{
  position:absolute;
  bottom:0;
  left:50%;
  transform:translateX(-50%);
  width:360px;                 /* üëâ dƒ©a d√†i h∆°n */
  height:20px;

  background:radial-gradient(ellipse at center,
    #f1f5f9 0%,
    #cbd5e1 40%,
    #9ca3af 65%,
    #6b7280 100%);

  border-radius:0 0 180px 180px;
  z-index:6;                   /* üëâ CAO NH·∫§T */
  pointer-events:none;
}

/* BUTTON */
.buttons{
  display:flex;
  justify-content:space-around;
  margin-top:0;
  transform: none;
}
.buttons button{
  width:120px;
  padding:10px;
  border:none;
  border-radius:8px;
  font-size:18px;
  cursor:pointer;
  color:#fff;
}
.tai{background:#22c55e;}
.xiu{background:#3b82f6;}

/* HISTORY */
.history{
  margin-top: 30px;
  border:1px solid #334155;
  border-radius:8px;
  padding:8px;
  max-height:120px;
  overflow:auto;
  transform: none;
}
.history h4{margin:0 0 6px;text-align:center;}
.history-item{
  font-size:14px;
  border-bottom:1px solid #1e293b;
  padding:3px 0;
}

.multiplier-float{
  position:absolute;
  left:50%;
  bottom:120px;
  transform:translateX(-50%);
  font-size:36px;
  font-weight:bold;
  pointer-events:none;
  animation: floatUp 1.2s ease-out forwards;
  text-shadow:0 0 20px currentColor;
}

.multiplier-2{ color:#22c55e; }
.multiplier-3{ color:#3b82f6; }
.multiplier-5{ color:#facc15; }

@keyframes floatUp{
  0%{ opacity:0; transform:translate(-50%,20px) scale(.6); }
  20%{ opacity:1; }
  100%{ opacity:0; transform:translate(-50%,-60px) scale(1.2); }
}

.buff-bar{
  display:flex;
  justify-content:center;
  gap:12px;
  margin:10px 0;
}

.buff{
  width:36px;
  height:36px;
  border-radius:50%;
  background:#1e293b;
  border:2px solid #334155;
  position:relative;
}

.buff::after{
  content:"√ó" attr(data-m);
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  opacity:.5;
}

/* ƒëang s·∫°c */
.buff.charging{
  box-shadow:0 0 12px #64748b;
  opacity:.8;
}

/* ƒë√£ k√≠ch ho·∫°t */
.buff.active{
  background:#22c55e;
  box-shadow:0 0 20px #22c55e;
  opacity:1;
}

/* m·ªëc 10 ‚Äì MAX */
.buff.max{
  background:#facc15;
  box-shadow:0 0 30px #facc15;
  animation:pulse 1s infinite;
}

@keyframes pulse{
  0%{ transform:scale(1); }
  50%{ transform:scale(1.1); }
  100%{ transform:scale(1); }
}
.buff{
  position:relative;
  cursor:pointer;
}

/* tooltip */
.buff-tooltip{
  position:absolute;
  bottom:110%;
  left:50%;
  transform:translateX(-50%);
  background:#020617;
  color:#fff;
  padding:6px 10px;
  border-radius:8px;
  font-size:13px;
  white-space:nowrap;
  box-shadow:0 0 15px rgba(0,0,0,.6);
  opacity:0;
  pointer-events:none;
  transition:.2s;
  z-index:10;
}

.buff-tooltip::after{
  content:"";
  position:absolute;
  top:100%;
  left:50%;
  transform:translateX(-50%);
  border:6px solid transparent;
  border-top-color:#020617;
}

/* hi·ªán tooltip */
.buff.show-tooltip .buff-tooltip{
  opacity:1;
  pointer-events:auto;
}
#lixiBtn{
  padding:8px 14px;
  border:none;
  border-radius:10px;
  background:linear-gradient(45deg,#facc15,#f97316);
  color:#000;
  font-weight:bold;
  cursor:pointer;
}
#lixiBtn:disabled{
  opacity:.5;
  cursor:not-allowed;
}

/* ===== SHAKE GROUP ===== */
.shake-group{
  position:relative;
  z-index:50;
  transform-origin:center bottom;
}

.shake-group.focus{
  transform: scale(1.4);
}



/* ===== L·∫ÆC QUA TR√ÅI PH·∫¢I ===== */
@keyframes shakeSide{
  0%   { transform:scale(1.4) translateX(0); }
  15%  { transform:scale(1.4) translateX(-40px); }
  30%  { transform:scale(1.4) translateX(40px); }
  45%  { transform:scale(1.4) translateX(-32px); }
  60%  { transform:scale(1.4) translateX(32px); }
  75%  { transform:scale(1.4) translateX(-22px); }
  100% { transform:scale(1.4) translateX(0); }
}


.shake-group.focus.shaking{
  animation: shakeSide .9s cubic-bezier(.36,.07,.19,.97);
}

#focusOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  backdrop-filter: blur(6px);
  opacity:0;
  pointer-events:none;
  transition:.25s;
  z-index:40;
}

#focusOverlay.show{
  opacity:1;
  pointer-events:auto;
}


.focus-stage{
  position:relative;
  opacity:1;
  pointer-events:auto;
  transform:none;
}


.focus-stage.show{
  position:fixed;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%) scale(1.15);
  z-index:100;
}

.game{
  position:relative;
  z-index:1;
}

</style>
</head>

<body>
<div class="game">
  <div class="top">üé≤ T√ÄI X·ªàU CASINO</div>

<div class="money-area">
  <div class="money">üí∞ Ti·ªÅn: <span id="money">1000</span></div>
  <button id="lixiBtn" onclick="claimLixi()">üßß Nh·∫≠n l√¨ x√¨</button>

</div>

  
  <div class="bet">
    üéØ C∆∞·ª£c:
    <button onclick="changeBet(-25)">‚àí</button>
    <span id="bet">0</span>
    <button onclick="changeBet(25)">+</button>
    <button onclick="clearBet()">üóë</button>
  </div>

  <div class="chips">
    <img src="images/chip-25.png" class="chip" onclick="addBet(25)">
    <img src="images/chip-50.png" class="chip" onclick="addBet(50)">
    <img src="images/chip-100.png" class="chip" onclick="addBet(100)">
    <img src="images/chip-250.png" class="chip" onclick="addBet(250)">
    <img src="images/chip-500.png" class="chip" onclick="addBet(500)">
  </div>

<div class="buff-bar">
  <div class="buff buff-2" data-m="2"></div>
  <div class="buff buff-3" data-m="3"></div>
  <div class="buff buff-5" data-m="5"></div>
</div>




<!-- overlay n·ªÅn m·ªù -->

<div class="bowl-area">
  <div class="shake-group" id="shakeGroup">

    <div class="dice-area">
      <div class="dice">?</div>
      <div class="dice">?</div>
      <div class="dice">?</div>
    </div>

    <div class="bowl-wrap" id="bowlWrap">
      <div class="bowl" id="bowl"></div>
    </div>

    <div class="plate"></div>
  </div>
</div>

<div id="focusOverlay"></div>



<div class="buttons">
    <button class="tai" onclick="play('tai')">T√ÄI</button>
    <button class="xiu" onclick="play('xiu')">X·ªàU</button>
  </div>

<div class="history">
    <h4>L·ªãch s·ª≠</h4>
    <div id="historyList"></div>
  </div>
<!-- POPUP TH·∫ÆNG / THUA -->
<div id="overlay" class="overlay hidden">
  <div class="popup">
    <h2 id="popupTitle"></h2>
    <p id="popupText"></p>
    <canvas id="fireworks"></canvas>
  </div>
</div>


<script>
let money = 1000;
let bet = 0;
let isBowlOpen = false;
let pendingResult = null;
let resultHandled = false;
let lixiClaimed = false;
let winStreak = 0;

const bowl = document.getElementById("bowl");
const bowlWrap = document.getElementById("bowlWrap");
const diceEls = document.querySelectorAll(".dice");
const historyList = document.getElementById("historyList");
const focusOverlay = document.getElementById("focusOverlay");



/* ===== BET ===== */
function addBet(v){
  if(pendingResult) return alert("M·ªü b√°t ƒëi tr·ªùi, ƒë·ª£i nh·∫Øc h·∫£?");
  if(money < bet + v) return alert("ƒê√©o ƒë·ªß ti·ªÅn k√¨a cha ∆°i cha");
  bet += v;
  updateBet();
}
function changeBet(v){
  if(pendingResult) return;
  if(bet + v < 0) return;
  if(money < bet + v) return alert("Kh√¥ng ƒë·ªß ti·ªÅn, tao nu·ªët h·∫øt r·ªìi");
  bet += v;
  updateBet();
}
function clearBet(){
  bet = 0;
  updateBet();
}
function updateBet(){
  document.getElementById("bet").innerText = bet;
}

/* ===== PLAY ===== */
function play(choice){
  if(bet === 0) return alert("M√†y b·ªã ngu √†, ƒë√£ ƒë·∫∑t c∆∞·ª£c ƒë√¢u");
  if(pendingResult) return alert("Bi·∫øt ch∆°i kh√¥ng v·∫≠y, l·∫≠y b·ªë");
  startShake();
  closeBowl();

  const d1 = rand(), d2 = rand(), d3 = rand();
  const total = d1 + d2 + d3;
  const isTriple = (d1 === d2 && d2 === d3);

  let result;
  if(isTriple){
    result = "triple";
  }else if(total <= 10){
    result = "xiu";
  }else{
    result = "tai";
  }

  pendingResult = { d1,d2,d3,total,result,choice };
  resultHandled = false;

  diceEls.forEach(d=>d.innerText="?");
}


/* ===== M·ªû B√ÅT ===== */
function openBowl(){
  if(!pendingResult || resultHandled) return;
  stopShake();

  resultHandled = true;
  isBowlOpen = true;
  bowlWrap.style.transform = "translateY(-80px)";

  const { d1,d2,d3,total,result,choice } = pendingResult;

  // hi·ªán x√∫c x·∫Øc
  diceEls[0].innerText = d1;
  diceEls[1].innerText = d2;
  diceEls[2].innerText = d3;

  /* ===== X·ª¨ L√ù K·∫æT QU·∫¢ ===== */
  if(result === "triple"){
    winStreak = 0;

    // ƒë√£ tr·ª´ ti·ªÅn c∆∞·ª£c t·ª´ tr∆∞·ªõc
    addHistory(`${d1}-${d2}-${d3} | B·ªò BA | ${total}`);
    showPopup("lose");
  }

  else if(result === choice){
    winStreak++;

    const rewardMultiplier = getMultiplier(winStreak);

    // tr·∫£ v·ªën + l√£i
    const payout = bet * (rewardMultiplier + 1);
    money += payout;

    showMultiplierFloat(rewardMultiplier);

    addHistory(
      `${d1}-${d2}-${d3} | ${result.toUpperCase()} | ${total} √ó${rewardMultiplier}`
    );

    showPopup("win");
  }

  else{
    winStreak = 0;

    // thua th√¨ m·∫•t ti·ªÅn c∆∞·ª£c ƒë√£ tr·ª´
    addHistory(`${d1}-${d2}-${d3} | ${result.toUpperCase()} | ${total}`);
    showPopup("lose");
  }

  /* ===== C·∫¨P NH·∫¨T UI ===== */
  updateBuffUI();
  document.getElementById("money").innerText = money;
  clearBet();

  pendingResult = null;
}


function getMultiplier(streak){
  if(streak >= 10) return 5;
  if(streak >= 5) return 3;
  if(streak >= 3) return 2;
  return 1;
}



/* ===== ƒê√ìNG B√ÅT ===== */
function closeBowl(){
  isBowlOpen = false;
  bowlWrap.style.transform = "translateY(0)";
}

function updateBuffUI(){
  document.querySelectorAll(".buff").forEach(b=>{
    b.classList.remove("active","charging","max");
  });

  if(winStreak >= 1 && winStreak < 3)
    document.querySelector('.buff[data-m="2"]').classList.add("charging");

  if(winStreak >= 3)
    document.querySelector('.buff[data-m="2"]').classList.add("active");

  if(winStreak >= 4 && winStreak < 5)
    document.querySelector('.buff[data-m="3"]').classList.add("charging");

  if(winStreak >= 5)
    document.querySelector('.buff[data-m="3"]').classList.add("active");

  if(winStreak >= 9 && winStreak < 10)
    document.querySelector('.buff[data-m="5"]').classList.add("charging");

  if(winStreak >= 10)
    document.querySelector('.buff[data-m="5"]').classList.add("active","max");
}

document.querySelectorAll(".buff").forEach(buff=>{
  const m = buff.dataset.m;

  const tooltip = document.createElement("div");
  tooltip.className = "buff-tooltip";

  if(m === "2"){
    tooltip.innerText = "Th·∫Øng 3 v√°n li√™n ti·∫øp ‚Üí x2 ti·ªÅn c∆∞·ª£c";
  }
  if(m === "3"){
    tooltip.innerText = "Th·∫Øng 5 v√°n li√™n ti·∫øp ‚Üí x3 ti·ªÅn c∆∞·ª£c";
  }
  if(m === "5"){
    tooltip.innerText = "Th·∫Øng 10 v√°n li√™n ti·∫øp ‚Üí x5 ti·ªÅn c∆∞·ª£c";
  }

  buff.appendChild(tooltip);

  buff.addEventListener("click", e=>{
    e.stopPropagation();

    document.querySelectorAll(".buff")
      .forEach(b=>b.classList.remove("show-tooltip"));

    buff.classList.toggle("show-tooltip");
  });
});

/* click ra ngo√†i ‚Üí t·∫Øt tooltip */
document.addEventListener("click", ()=>{
  document.querySelectorAll(".buff")
    .forEach(b=>b.classList.remove("show-tooltip"));
});

/* ===== K√âO M·ªû / TAP ƒê√ìNG ===== */
let startY = null;

bowl.addEventListener("pointerdown", e=>{
  startY = e.clientY;
  if(isBowlOpen){
    e.preventDefault();
    closeBowl();
  }
});

bowl.addEventListener("pointermove", e=>{
  if(startY === null || isBowlOpen) return;
  const diff = startY - e.clientY;
  if(diff > 0){
    bowlWrap.style.transform = `translateY(-${Math.min(diff,120)}px)`;
  }
});

bowl.addEventListener("pointerup", e=>{
  if(startY === null || isBowlOpen) return;
  if(startY - e.clientY > 60) openBowl();
  else bowlWrap.style.transform = "translateY(0)";
  startY = null;
});

/* ===== BUFF UI ===== */
function showMultiplierFloat(multiplier){
  if(multiplier < 2) return;

  const div = document.createElement("div");
  div.className = `multiplier-float multiplier-${multiplier}`;
  div.innerText = `√ó${multiplier}`;

  document.querySelector(".bowl-area").appendChild(div);

  setTimeout(()=>div.remove(),1200);
}

function showPopup(type){
  const overlay = document.getElementById("overlay");
  const title = document.getElementById("popupTitle");
  const text = document.getElementById("popupText");

  if(type === "win"){
    title.innerText = "üéâ TH·∫ÆNG!";
    text.innerText = "ƒÇn r√πa ƒë∆∞·ª£c t∆∞·ªüng m√¨nh hay h·∫£?!";
  }else{
    title.innerText = "üí• THUA!";
    text.innerText = "Haha th·∫•y ngu ch∆∞a con ∆°i!";
  }

  overlay.classList.remove("hidden");

  setTimeout(()=>{
    overlay.classList.add("hidden");
  },1500);
}
function claimLixi(){
  if(lixiClaimed){
    showModal("lose");
    document.getElementById("modalText").innerText =
      "üßß B·∫°n ƒë√£ nh·∫≠n l√¨ x√¨ r·ªìi! Reload trang ƒë·ªÉ nh·∫≠n l·∫°i.";
    return;
  }

  const amount = Math.floor(Math.random()*401) + 500;

  money += amount;
  document.getElementById("money").innerText = money;

  lixiClaimed = true;

  showModal("win");
  document.getElementById("modalText").innerText =
    `üßß B·∫°n nh·∫≠n ƒë∆∞·ª£c ${amount} ti·ªÅn l√¨ x√¨!`;

  document.getElementById("lixiBtn").disabled = true;
}



function startShake(){
  // b·∫≠t overlay + focus
  focusOverlay.classList.add("show");
  shakeGroup.classList.add("focus");

  // b·∫Øt ƒë·∫ßu l·∫Øc
  shakeGroup.classList.add("shaking");

  // ‚è± l·∫Øc xong th√¨ d·ª´ng, nh∆∞ng v·∫´n focus
  setTimeout(()=>{
    shakeGroup.classList.remove("shaking");
  }, 600); // ƒë√∫ng b·∫±ng th·ªùi gian animation
}


function stopShake(){
  shakeGroup.classList.remove("shaking","focus");
  focusOverlay.classList.remove("show");
}

/* ===== HISTORY ===== */
function addHistory(text){
  const div = document.createElement("div");
  div.className = "history-item";
  div.innerText = text;
  historyList.prepend(div);
}

/* ===== RANDOM ===== */
function rand(){
  return Math.floor(Math.random()*6)+1;
}

</script>
</body>
</html>
